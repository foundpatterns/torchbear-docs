<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Module List</title>
    <link rel="stylesheet" type="text/css" href="../../../css/lua.css">
</head>
<body>
	<pre><code id="1">use rlua::prelude::*;</code><code id="2">use std::net::Ipv6Addr;</code><code id="3">use crate::bindings::net::ipv4::LuaIpv4;</code><code id="4"></code><code id="5">pub struct LuaIpv6(pub Ipv6Addr);</code><code id="6"></code><code id="7">impl LuaUserData for LuaIpv6 {</code><code id="8">    fn add_methods&lt;&#x27;lua, M: LuaUserDataMethods&lt;&#x27;lua, Self&gt;&gt;(methods: &amp;mut M) {</code><code id="9">        methods.add_method(&quot;segments&quot;, |_, this: &amp;LuaIpv6, _: ()| {</code><code id="10">            Ok(this.0.octets().to_vec())</code><code id="11">        });</code><code id="12">        methods.add_method(&quot;is_unspecified&quot;, |_, this: &amp;LuaIpv6, _: ()| {</code><code id="13">            Ok(this.0.is_unspecified())</code><code id="14">        });</code><code id="15">        methods.add_method(&quot;is_loopback&quot;, |_, this: &amp;LuaIpv6, _: ()| {</code><code id="16">            Ok(this.0.is_loopback())</code><code id="17">        });</code><code id="18">        methods.add_method(&quot;is_multicast&quot;, |_, this: &amp;LuaIpv6, _: ()| {</code><code id="19">            Ok(this.0.is_multicast())</code><code id="20">        });</code><code id="21">        methods.add_method(&quot;octets&quot;, |_, this: &amp;LuaIpv6, _: ()| {</code><code id="22">            Ok(this.0.octets().to_vec())</code><code id="23">        });</code><code id="24">        methods.add_method(&quot;to_ipv4&quot;, |_, this: &amp;LuaIpv6, _: ()| {</code><code id="25">            Ok(this.0.to_ipv4().map(LuaIpv4))</code><code id="26">        });</code><code id="27">        methods.add_meta_method(LuaMetaMethod::ToString, |_, this, _: ()| {</code><code id="28">            Ok(this.0.to_string())</code><code id="29">        });</code><code id="30">    }</code><code id="31">}</code><code id="32"></code><code id="33">pub fn init(lua: &amp;Lua) -&gt; crate::Result&lt;()&gt; {</code><code id="34">    let module = lua.create_table()?;</code><code id="35"></code><code id="36">    module.set(&quot;new&quot;, lua.create_function( |_, ip: String| {</code><code id="37">        ip.parse().map(LuaIpv6).map_err(LuaError::external)</code><code id="38">    })? )?;</code><code id="39"></code><code id="40">    module.set(&quot;from_table&quot;, lua.create_function( |_, ip: Vec&lt;u16&gt;| {</code><code id="41">        if ip.len() != 8 {</code><code id="42">            return Ok(None);</code><code id="43">        }</code><code id="44">        let (a, b, c, d, e, f, g, h) = (</code><code id="45">            ip.get(0).unwrap_or(&amp;0),</code><code id="46">            ip.get(1).unwrap_or(&amp;0),</code><code id="47">            ip.get(2).unwrap_or(&amp;0),</code><code id="48">            ip.get(3).unwrap_or(&amp;0),</code><code id="49">            ip.get(4).unwrap_or(&amp;0),</code><code id="50">            ip.get(5).unwrap_or(&amp;0),</code><code id="51">            ip.get(6).unwrap_or(&amp;0),</code><code id="52">            ip.get(7).unwrap_or(&amp;0));</code><code id="53"></code><code id="54">        Ok(Some(LuaIpv6(Ipv6Addr::new(*a, *b, *c, *d, *e, *f, *g, *h))))</code><code id="55">    })? )?;</code><code id="56"></code><code id="57">    lua.globals().set(&quot;ipv6&quot;, module)?;</code><code id="58"></code><code id="59">    Ok(())</code><code id="60">}</code></pre>
</body>
</html>
