<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Module List</title>
    <link rel="stylesheet" type="text/css" href="../../../css/lua.css">
</head>
<body>
	<pre><code id="1">use rlua::prelude::*;</code><code id="2">use rlua::{Variadic, Value};</code><code id="3"></code><code id="4">pub fn init(lua: &amp;Lua) -&gt; ::Result&lt;()&gt; {</code><code id="5"></code><code id="6">    fn tostr (lua: &amp;Lua, args: Variadic&lt;Value&gt;) -&gt; LuaResult&lt;String&gt; {</code><code id="7">        let f: LuaFunction = lua.globals().get(&quot;tostring&quot;)?;</code><code id="8">        let mut s =  String::new();</code><code id="9">        for value in args.into_iter() {</code><code id="10">            let vs: String = f.call(value)?;</code><code id="11">            s.push(&#x27;\t&#x27;);</code><code id="12">            s.push_str(&amp;vs);</code><code id="13">        }</code><code id="14">        Ok(s)</code><code id="15">    }</code><code id="16"></code><code id="17">    let module = lua.create_table()?;</code><code id="18"></code><code id="19">    module.set(&quot;error&quot;, lua.create_function( |lua, args: _| {</code><code id="20">        error!(&quot;{}&quot;, tostr(lua, args)?);</code><code id="21">        Ok(())</code><code id="22">    })? )?;</code><code id="23"></code><code id="24">    module.set(&quot;warn&quot;, lua.create_function( |lua, args: _| {</code><code id="25">        warn!(&quot;{}&quot;, tostr(lua, args)?);</code><code id="26">        Ok(())</code><code id="27">    })? )?;</code><code id="28"></code><code id="29">    module.set(&quot;info&quot;, lua.create_function( |lua, args: _| {</code><code id="30">        info!(&quot;{}&quot;, tostr(lua, args)?);</code><code id="31">        Ok(())</code><code id="32">    })? )?;</code><code id="33"></code><code id="34">    module.set(&quot;debug&quot;, lua.create_function( |lua, args: _| {</code><code id="35">        debug!(&quot;{}&quot;, tostr(lua, args)?);</code><code id="36">        Ok(())</code><code id="37">    })? )?;</code><code id="38"></code><code id="39">    module.set(&quot;trace&quot;, lua.create_function( |lua, args: _| {</code><code id="40">        trace!(&quot;{}&quot;, tostr(lua, args)?);</code><code id="41">        Ok(())</code><code id="42">    })? )?;</code><code id="43"></code><code id="44">    lua.globals().set(&quot;log&quot;, module)?;</code><code id="45"></code><code id="46">    Ok(())</code><code id="47">}</code><code id="48"></code><code id="49">#[cfg(test)]</code><code id="50">mod tests {</code><code id="51">    use super::*;</code><code id="52"></code><code id="53">    #[test]</code><code id="54">    fn lua_log () {</code><code id="55"></code><code id="56">        let colors = ::fern::colors::ColoredLevelConfig::new();</code><code id="57"></code><code id="58">        ::fern::Dispatch::new()</code><code id="59">            .format(move |out, message, record| {</code><code id="60">                out.finish(format_args!(</code><code id="61">                    &quot;{}: {}&quot;, colors.color(record.level()), message</code><code id="62">                ))</code><code id="63">            })</code><code id="64">            .level(::log::LevelFilter::Trace)</code><code id="65">            .chain(::std::io::stdout())</code><code id="66">            .apply().unwrap();</code><code id="67"></code><code id="68">        let lua = Lua::new();</code><code id="69">        init(&amp;lua).unwrap();</code><code id="70"></code><code id="71">        lua.exec::&lt;_, ()&gt;(r#&quot;</code><code id="72">            log.info(4, &quot;foo&quot;, nil, {})</code><code id="73">            log.error(&quot;Some Scary Error&quot;)</code><code id="74">            log.warn(&quot;Warning&quot;)</code><code id="75">            log.debug(&quot;Debug&quot;)</code><code id="76">            log.trace(&quot;Trace&quot;, &quot;with&quot;, {}, &quot;data&quot;)</code><code id="77">        &quot;#, None).unwrap();</code><code id="78">    }</code><code id="79">}</code></pre>
</body>
</html>
