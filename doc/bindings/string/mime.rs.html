<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Module List</title>
    <link rel="stylesheet" type="text/css" href="../../../css/lua.css">
</head>
<body>
	<pre><code id="1">use rlua::prelude::*;</code><code id="2">use mime_guess;</code><code id="3"></code><code id="4">pub fn init(lua: &amp;Lua) -&gt; crate::Result&lt;()&gt; {</code><code id="5">    let module = lua.create_table()?;</code><code id="6">    module.set(&quot;get_mime_type&quot;, lua.create_function(|_, ext: String| {</code><code id="7">        Ok(mime_guess::get_mime_type(&amp;ext).to_string())</code><code id="8">    })?)?;</code><code id="9"></code><code id="10">    module.set(&quot;guess_mime_type&quot;, lua.create_function(|_, path: String| {</code><code id="11">        Ok(mime_guess::guess_mime_type(&amp;path).to_string())</code><code id="12">    })?)?;</code><code id="13"></code><code id="14">    lua.globals().set(&quot;mime&quot;, module)?;</code><code id="15"></code><code id="16">    Ok(())</code><code id="17">}</code><code id="18"></code><code id="19">#[cfg(test)]</code><code id="20">mod tests {</code><code id="21">    use super::*;</code><code id="22"></code><code id="23">    #[test]</code><code id="24">    fn lua_mime_get_type () {</code><code id="25">        let lua = Lua::new();</code><code id="26">        init(&amp;lua).unwrap();</code><code id="27"></code><code id="28">        lua.exec::&lt;_, ()&gt;(r#&quot;</code><code id="29">            local mime = mime.get_mime_type(&quot;gif&quot;)</code><code id="30">            assert(mime == &quot;image&#x2F;gif&quot;)</code><code id="31">        &quot;#, None).unwrap();</code><code id="32">    }</code><code id="33"></code><code id="34">    #[test]</code><code id="35">    fn lua_mime_guess_type () {</code><code id="36">        let lua = Lua::new();</code><code id="37">        init(&amp;lua).unwrap();</code><code id="38"></code><code id="39">        lua.exec::&lt;_, ()&gt;(r#&quot;</code><code id="40">            local mime = mime.guess_mime_type(&quot;file.txt&quot;)</code><code id="41">            assert(mime == &quot;text&#x2F;plain&quot;)</code><code id="42">        &quot;#, None).unwrap();</code><code id="43">    }</code><code id="44">}</code></pre>
</body>
</html>
