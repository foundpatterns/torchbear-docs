<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Module List</title>
    <link rel="stylesheet" type="text/css" href="../../../css/lua.css">
</head>
<body>
	<pre><code id="1">use rlua::prelude::*;</code><code id="2">use std::{</code><code id="3">    collections::HashMap,</code><code id="4">    env</code><code id="5">};</code><code id="6"></code><code id="7">pub fn init(lua: &amp;Lua) -&gt; crate::Result&lt;()&gt; {</code><code id="8">    let module = lua.create_table()?;</code><code id="9"></code><code id="10">    module.set(&quot;current_dir&quot;, lua.create_function( |_, _: ()| {</code><code id="11">        env::current_dir().map(|path| path.to_str().map(|s| s.to_string())).map_err(LuaError::external)</code><code id="12">    })? )?;</code><code id="13"></code><code id="14">    module.set(&quot;current_exe&quot;, lua.create_function( |_, _: ()| {</code><code id="15">        env::current_exe().map(|path| path.to_str().map(|s| s.to_string())).map_err(LuaError::external)</code><code id="16">    })? )?;</code><code id="17"></code><code id="18">    module.set(&quot;remove_var&quot;, lua.create_function( |_, var: String | {</code><code id="19">        Ok(env::remove_var(var))</code><code id="20">    })? )?;</code><code id="21"></code><code id="22">    module.set(&quot;set_current_dir&quot;, lua.create_function( |_, path: String| {</code><code id="23">        env::set_current_dir(path).map_err(LuaError::external)</code><code id="24">    })? )?;</code><code id="25"></code><code id="26">    module.set(&quot;set_var&quot;, lua.create_function( |_, (k, v): (String, String)| {</code><code id="27">        Ok(env::set_var(k, v))</code><code id="28">    })? )?;</code><code id="29"></code><code id="30">    module.set(&quot;var&quot;, lua.create_function( |_, k: String| {</code><code id="31">        env::var(k).map_err(LuaError::external)</code><code id="32">    })? )?;</code><code id="33"></code><code id="34">    module.set(&quot;vars&quot;, lua.create_function( |_, _: ()| {</code><code id="35">        &#x2F;&#x2F;We are going to use &quot;vars_os&quot; due to the nature of &quot;vars&quot; when iterating over the list of variable that could result in a panic</code><code id="36">        let list: HashMap&lt;String, String&gt; = env::vars_os()</code><code id="37">            .into_iter()</code><code id="38">            .map(|(k, v)| (k.into_string().unwrap(), v.into_string().unwrap()))</code><code id="39">            .collect();</code><code id="40"></code><code id="41">        Ok(list)</code><code id="42"></code><code id="43">    })? )?;</code><code id="44"></code><code id="45">    lua.globals().set(&quot;env&quot;, module)?;</code><code id="46"></code><code id="47">    Ok(())</code><code id="48">}</code><code id="49"></code></pre>
</body>
</html>
